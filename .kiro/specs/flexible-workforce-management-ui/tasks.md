# Implementation Plan: Flexible Workforce Management - Frontend UI

## Overview

Triển khai giao diện người dùng cho hệ thống quản lý nhân sự linh hoạt, bao gồm:

- Unified Attendance View
- Shift Management
- Employee Salary Configuration
- Payroll Period Workflow
- Employment Contract Management
- Reports and Statistics
- Confirmation Dialogs và Detail Dialogs

Khi Kiro thực hiện task hãy phản hồi tôi bằng tiếng việt.

## Tasks

- [x] 1. Types và API Functions
  - [x] 1.1 Create new types in types/attendance-records.ts
    - UnifiedAttendanceRecord, ShiftTemplate, ShiftAssignment, ShiftSwapRequest
    - EmployeeSalaryConfig, EmployeeAllowance, EmployeeDeduction
    - PayrollPeriod, PayrollItem, EmploymentContract
    - _Requirements: 1.1-13.6_
  - [x] 1.2 Create new enums in types/attendance-enums.ts
    - ShiftAssignmentStatus, SwapRequestStatus, PayrollPeriodStatus
    - PayrollItemStatus, ContractType, ContractStatus
    - _Requirements: 1.1-13.6_
  - [x] 1.3 Create unified-attendance-api.ts
    - getTodayAttendance, getAttendanceByDate (unified response)
    - checkIn, checkOut, startBreak, endBreak
    - _Requirements: 1.1-1.7_
  - [x] 1.4 Create shift-api.ts
    - CRUD for shift templates, assignments, swap requests
    - _Requirements: 3.1-5.5_
  - [x] 1.5 Create salary-config-api.ts
    - CRUD for employee salary config
    - _Requirements: 6.1-6.8_
  - [x] 1.6 Create employee-allowance-api.ts and employee-deduction-api.ts
    - CRUD for individual allowances/deductions
    - _Requirements: 7.1-7.6_
  - [x] 1.7 Create payroll-period-api.ts
    - CRUD for payroll periods, items, workflow actions
    - _Requirements: 8.1-9.8_
  - [x] 1.8 Create contract-api.ts
    - CRUD for employment contracts
    - _Requirements: 10.1-10.7_
  - [x] 1.9 Create report-api.ts
    - Report generation and export
    - _Requirements: 11.1-11.9_

- [x] 2. i18n Messages
  - [x] 2.1 Add shift management messages to vi.json, en.json, ja.json
    - shifts namespace: templates, assignments, swaps, statuses
    - _Requirements: 3.1-5.5_
  - [x] 2.2 Add salary config messages
    - salaryConfig namespace: types, form labels, history
    - _Requirements: 6.1-6.8_
  - [x] 2.3 Add payroll messages
    - payroll namespace: periods, items, workflow, breakdown
    - _Requirements: 8.1-9.8_
  - [x] 2.4 Add contract messages
    - contracts namespace: types, statuses, form labels
    - _Requirements: 10.1-10.7_
  - [x] 2.5 Add confirmation dialog messages
    - dialogs namespace: titles, descriptions, buttons
    - _Requirements: 12.1-12.7_
  - [x] 2.6 Add enum translations
    - enums namespace: ShiftAssignmentStatus, SwapRequestStatus, etc.
    - _Requirements: 1.1-13.6_

- [x] 3. Shared Components
  - [x] 3.1 Create ConfirmationDialog component
    - Generic confirmation dialog with optional input field
    - Support variants: default, destructive, warning
    - _Requirements: 12.1-12.7_
  - [x] 3.2 Create DetailDialog base component
    - Reusable detail dialog with close button, responsive design
    - _Requirements: 13.1-13.6_
  - [ ]\* 3.3 Write property test for confirmation dialog behavior
    - **Property 9: Confirmation Dialog Behavior**
    - **Validates: Requirements 12.1-12.7**
  - [ ]\* 3.4 Write property test for detail dialog accessibility
    - **Property 10: Detail Dialog Accessibility**
    - **Validates: Requirements 13.5, 13.6**

- [x] 4. Unified Attendance View (Employee)
  - [x] 4.1 Refactor employee attendance page to use unified API
    - Update \_page-content.tsx to fetch unified attendance
    - _Requirements: 1.1_
  - [x] 4.2 Create \_unified-attendance-card.tsx
    - Display check-in/out status with embedded break records
    - _Requirements: 1.1, 1.4, 1.5_
  - [x] 4.3 Update \_break-section.tsx to work with unified data
    - Display break list from unified response
    - Show break compliance status
    - _Requirements: 1.5, 1.7_
  - [x] 4.4 Create \_attendance-day-detail-dialog.tsx
    - Show full attendance info: original/rounded times, working minutes, overtime, breaks
    - Show applied settings snapshot
    - _Requirements: 1.3, 1.6_
  - [x] 4.5 Update \_attendance-calendar.tsx to open detail dialog on day click
    - _Requirements: 1.2, 1.3_
  - [ ]\* 4.6 Write property test for detail dialog completeness
    - **Property 1: Detail Dialog Completeness**
    - **Validates: Requirements 1.6, 2.4, 2.5**

- [x] 5. Attendance Management (Manager)
  - [x] 5.1 Update company attendance page to use unified API
    - Fetch unified attendance records
    - _Requirements: 2.1_
  - [x] 5.2 Update \_attendance-table.tsx with filters
    - Add date range, employee, status filters
    - _Requirements: 2.1, 2.2_
  - [x] 5.3 Create \_attendance-detail-dialog.tsx for manager view
    - Show complete info with break records, applied settings, adjustment history
    - _Requirements: 2.3, 2.4, 2.5_
  - [x] 5.4 Add pagination and sorting to attendance table
    - _Requirements: 2.6_
  - [ ]\* 5.5 Write property test for filter accuracy
    - **Property 2: Filter Accuracy**
    - **Validates: Requirements 2.2**

- [x] 6. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 7. Shift Management
  - [x] 7.1 Create company/shifts/page.tsx - Shift management dashboard
    - Navigation to templates, assignments, swaps
    - _Requirements: 3.1_
  - [x] 7.2 Create company/shifts/templates/page.tsx
    - List shift templates with CRUD
    - _Requirements: 3.1, 3.2_
  - [x] 7.3 Create \_shift-template-form.tsx
    - Form with name, start time, end time, break minutes, multiplier
    - _Requirements: 3.2_
  - [x] 7.4 Create company/shifts/assignments/page.tsx
    - Calendar/table view of shift assignments
    - _Requirements: 3.3_
  - [x] 7.5 Create \_shift-assignment-dialog.tsx
    - Dialog to assign employee to shift
    - Show error if overlap exists
    - _Requirements: 3.4, 3.6_
  - [x] 7.6 Create \_shift-detail-dialog.tsx
    - Show shift details and employee info
    - _Requirements: 3.5_
  - [x] 7.7 Create company/shifts/swaps/page.tsx
    - List pending swap requests
    - _Requirements: 4.1_
  - [x] 7.8 Create \_shift-swap-detail-dialog.tsx
    - Show requester info, target employee info, both shifts
    - _Requirements: 4.2_
  - [x] 7.9 Create \_swap-approval-dialog.tsx
    - Confirmation dialog for approve/reject with reason input
    - _Requirements: 4.3, 4.4_
  - [ ]\* 7.10 Write property test for swap request detail completeness
    - **Property 3: Swap Request Detail Completeness**
    - **Validates: Requirements 4.2**

- [x] 8. Employee Schedule & Swap Request
  - [x] 8.1 Update employee/schedule/page.tsx
    - Show assigned shifts
    - _Requirements: 5.1_
  - [x] 8.2 Create \_swap-request-form.tsx
    - Show available shifts from other employees
    - Confirmation dialog before submit
    - _Requirements: 5.2, 5.3_
  - [x] 8.3 Create \_swap-request-history.tsx
    - Show pending/approved/rejected requests
    - _Requirements: 5.4, 5.5_

- [x] 9. Employee Salary Configuration
  - [x] 9.1 Create company/employees/[id]/salary/page.tsx
    - Display current salary config
    - _Requirements: 6.1_
  - [x] 9.2 Create \_salary-config-form.tsx
    - Salary type selector with conditional fields
    - _Requirements: 6.2_
  - [x] 9.3 Implement conditional form fields based on salary type
    - MONTHLY: monthlySalary input
    - DAILY: dailyRate input
    - HOURLY: hourlyRate input
    - SHIFT_BASED: shiftRate input
    - _Requirements: 6.3, 6.4, 6.5, 6.6_
  - [x] 9.4 Add confirmation dialog when saving affects current payroll
    - _Requirements: 6.7_
  - [x] 9.5 Create \_salary-config-history.tsx
    - Show history with effective dates
    - _Requirements: 6.8_
  - [ ]\* 9.6 Write property test for salary type form fields
    - **Property 4: Salary Type Form Fields**
    - **Validates: Requirements 6.3, 6.4, 6.5, 6.6**

- [x] 10. Individual Allowance/Deduction Management
  - [x] 10.1 Create company/employees/[id]/allowances/page.tsx
    - List assigned allowances
    - _Requirements: 7.1_
  - [x] 10.2 Create \_allowance-assignment-form.tsx
    - Form with allowance type, amount, taxable, effective dates
    - _Requirements: 7.2_
  - [x] 10.3 Create company/employees/[id]/deductions/page.tsx
    - List assigned deductions
    - _Requirements: 7.3_
  - [x] 10.4 Create \_deduction-assignment-form.tsx
    - Form with deduction type, amount/percentage, effective dates
    - _Requirements: 7.4_
  - [x] 10.5 Add deactivation with confirmation dialog
    - _Requirements: 7.5_
  - [x] 10.6 Implement visual distinction for company defaults vs overrides
    - _Requirements: 7.6_
  - [ ]\* 10.7 Write property test for allowance/deduction visual distinction
    - **Property 5: Allowance/Deduction Visual Distinction**
    - **Validates: Requirements 7.6**

- [x] 11. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 12. Payroll Period Management
  - [x] 12.1 Update company/payroll/page.tsx
    - Display payroll periods with status
    - _Requirements: 8.1_
  - [x] 12.2 Create \_payroll-period-form.tsx
    - Form with period start/end dates
    - _Requirements: 8.2_
  - [x] 12.3 Update company/payroll/[period]/page.tsx
    - Show all payroll items with summary
    - _Requirements: 8.3_
  - [x] 12.4 Create \_payroll-item-table.tsx
    - Table with breakdown columns
    - _Requirements: 8.4_
  - [x] 12.5 Create \_payroll-adjustment-dialog.tsx
    - Form requiring amount and reason
    - _Requirements: 8.5_
  - [x] 12.6 Create \_payroll-approval-dialog.tsx
    - Confirmation dialogs for submit, approve, pay
    - _Requirements: 8.6, 8.7, 8.8_
  - [x] 12.7 Implement locked state for APPROVED/PAID periods
    - Disable edit actions
    - _Requirements: 8.9_
  - [x] 12.8 Write property test for locked payroll state
    - **Property 7: Locked Payroll State**
    - **Validates: Requirements 8.9**

- [x] 13. Payroll Item Detail
  - [x] 13.1 Create \_payroll-item-detail-dialog.tsx
    - Show complete breakdown
    - _Requirements: 9.1_
  - [x] 13.2 Implement base salary calculation display
    - _Requirements: 9.2_
  - [x] 13.3 Implement overtime breakdown display
    - Regular, night, holiday, weekend
    - _Requirements: 9.3_
  - [x] 13.4 Implement allowances and deductions display
    - _Requirements: 9.4, 9.5_
  - [x] 13.5 Implement break deduction display
    - _Requirements: 9.6_
  - [x] 13.6 Implement adjustment history display
    - _Requirements: 9.7_
  - [x] 13.7 Implement gross/net salary with formula
    - _Requirements: 9.8_
  - [ ]\* 13.8 Write property test for payroll item breakdown completeness
    - **Property 6: Payroll Item Breakdown Completeness**
    - **Validates: Requirements 9.1-9.8**

- [x] 14. Employment Contract Management
  - [x] 14.1 Create company/contracts/page.tsx
    - Display contracts with status
    - _Requirements: 10.1_
  - [x] 14.2 Create \_contract-form.tsx
    - Form with contract type, dates, linked salary config
    - Show error if overlap exists
    - _Requirements: 10.2, 10.7_
  - [x] 14.3 Create \_contract-detail-dialog.tsx
    - Show full contract info
    - _Requirements: 10.3_
  - [x] 14.4 Create \_terminate-contract-dialog.tsx
    - Confirmation dialog with reason input
    - _Requirements: 10.4_
  - [x] 14.5 Implement expiring contract highlighting
    - Highlight contracts expiring within 30 days
    - _Requirements: 10.5_
  - [x] 14.6 Implement notification badge for expiring contracts
    - _Requirements: 10.6_
  - [ ]\* 14.7 Write property test for expiring contract indicators
    - **Property 8: Expiring Contract Indicators**
    - **Validates: Requirements 10.5, 10.6**

- [x] 15. Reports and Statistics
  - [x] 15.1 Update company/reports/page.tsx
    - Show available report types
    - _Requirements: 11.1_
  - [x] 15.2 Create company/reports/attendance/page.tsx
    - Attendance summary report with filters
    - _Requirements: 11.2, 11.3_
  - [x] 15.3 Create company/reports/overtime/page.tsx
    - Overtime breakdown report
    - _Requirements: 11.5_
  - [x] 15.4 Create company/reports/break-compliance/page.tsx
    - Break compliance report
    - _Requirements: 11.6_
  - [x] 15.5 Create company/reports/payroll-summary/page.tsx
    - Payroll summary report
    - _Requirements: 11.7_
  - [x] 15.6 Create company/reports/cost-analysis/page.tsx
    - Cost analysis report
    - _Requirements: 11.8_
  - [x] 15.7 Create company/reports/shift-utilization/page.tsx
    - Shift utilization report
    - _Requirements: 11.9_
  - [x] 15.8 Implement report export (CSV, PDF)
    - _Requirements: 11.4_

- [x] 16. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

## Notes

- Tasks marked with `*` are optional and can be skipped for faster MVP
- Each task references specific requirements for traceability
- Checkpoints ensure incremental validation
- Property tests validate universal correctness properties
- Unit tests validate specific examples and edge cases
